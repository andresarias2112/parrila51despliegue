<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil del Empleado | Parrilla 51</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
  /* Caja de formulario */
  .form-box {
    background-color: #2f2f2f;
    border: 2px solid #ffd700;
    padding: 25px;
    border-radius: 12px;
    color: white;
    width: 100%;
  }

  /* Para que ambos formularios estén al lado */
  .perfil-contenedor {
    display: flex;
    gap: 30px;
    margin-top: 30px;
    flex-wrap: wrap;
  }

  .perfil-contenedor .form-box {
    flex: 1;
    min-width: 350px; /* Evita que se vuelvan muy pequeños */
  }

  /* Título amarillo */
  .titulo-amarillo {
    color: #ffd700 !important;
    font-weight: bold;
  }

  /* Inputs iguales */
  .form-box .form-control, 
  .form-box .form-select {
    background-color: #3d3d3d;
    border: 1px solid #777;
    color: white;
  }

  .form-box .input-group-text {
    background-color: #3d3d3d;
    border: 1px solid #777;
    cursor: pointer;
  }
</style>

</head>

<body>
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="container mt-3">
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
  <div class="wrapper">
    <nav class="navbar">
      <div class="logo">
        <img src="{{ url_for('static', filename='img/logooo.png') }}" alt="Logo">
        <span>Parrilla 51</span>
      </div>

      <ul class="nav-links">
  
    </nav>

    <div class="perfil-contenedor">

  <!-- FORMULARIO DE PERFIL -->
  <form id="formPerfil" class="form-box">
    <h3 class="titulo-amarillo mb-3">Perfil del Empleado</h3>

    <div class="row mb-3">
      <div class="col-md-6">
        <label>Nombre</label>
        <input type="text" class="form-control" id="nombre" required>
      </div>
      <div class="col-md-6">
        <label>Apellido</label>
        <input type="text" class="form-control" id="apellido" required>
      </div>
    </div>

    <div class="mb-3">
      <label>Teléfono</label>
      <input type="text" class="form-control" id="telefono">
    </div>

    <div class="mb-3">
      <label>Dirección</label>
      <input type="text" class="form-control" id="direccion">
    </div>

    <div class="mb-3">
      <label>Correo</label>
      <input type="email" class="form-control" id="correo" required>
    </div>

    <button type="submit" class="btn btn-danger w-100">Actualizar Perfil</button>
  </form>

  <!-- FORMULARIO CAMBIAR CONTRASEÑA -->
  <form id="formContrasena" class="form-box">
    <h3 class="titulo-amarillo mb-3">Cambiar Contraseña</h3>

    <label>Contraseña Actual</label>
    <div class="input-group mb-3">
      <input type="password" class="form-control" id="oldPass" required>
      <span class="input-group-text" onclick="togglePassword('oldPass', this)">
        <i class="bi bi-eye-slash"></i>
      </span>
    </div>

    <label>Nueva Contraseña</label>
    <div class="input-group mb-3">
      <input type="password" class="form-control" id="newPass" required>
      <span class="input-group-text" onclick="togglePassword('newPass', this)">
        <i class="bi bi-eye-slash"></i>
      </span>
    </div>

    <button type="submit" class="btn btn-danger w-100">Cambiar Contraseña</button>
  </form>

</div>



      <!-- BOTÓN VOLVER -->
      <div class="volver-wrap">
        <a href="{{ url_for('empleado.empleado_dashboard') }}" class="volver">← Volver al Dashboard</a>
      </div>
    </div>
  </div>

  <footer>
    © 2025 Parrilla 51 - Todos los derechos reservados
  </footer>

  <script>
    // CARGAR PERFIL
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch("/empleado/api/perfil");
        const data = await res.json();

        if (data.error) {
          alert(data.mensaje || "Error al cargar perfil");
          return;
        }

        document.getElementById("nombre").value = data.nombre || "";
        document.getElementById("apellido").value = data.apellido || "";
        document.getElementById("telefono").value = data.telefono || "";
        document.getElementById("direccion").value = data.direccion || "";
        document.getElementById("correo").value = data.correo || "";
      } catch (err) {
        console.error(err);
        alert("No se pudo cargar el perfil");
      }
    });

    // ACTUALIZAR PERFIL
    document.getElementById("formPerfil").addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        nombre: document.getElementById("nombre").value,
        apellido: document.getElementById("apellido").value,
        telefono: document.getElementById("telefono").value,
        direccion: document.getElementById("direccion").value,
        correo: document.getElementById("correo").value
      };

      const res = await fetch("/empleado/api/perfil", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      alert(result.mensaje);
    });

    // CAMBIAR CONTRASEÑA
    document.getElementById("formContrasena").addEventListener("submit", async (e) => {
      e.preventDefault();

      const data = {
        oldPass: document.getElementById("oldPass").value,
        newPass: document.getElementById("newPass").value
      };

      const res = await fetch("/empleado/api/cambiar_contrasena", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });

      const result = await res.json();
      alert(result.mensaje);

      if (!result.error) {
        document.getElementById("formContrasena").reset();
      }
    });

    // MOSTRAR / OCULTAR CONTRASEÑA
    function togglePassword(id, iconElement) {
      const input = document.getElementById(id);
      const icon = iconElement.querySelector("i");

      if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("bi-eye-slash", "bi-eye");
      } else {
        input.type = "password";
        icon.classList.replace("bi-eye", "bi-eye-slash");
      }
    }
  </script>
</body>
</html>
